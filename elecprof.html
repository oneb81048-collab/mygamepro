<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professeur Volta - Acc√®s Libre</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary: #1e272e;
            --accent: #f39c12;
            --user-blue: #0984e3;
            --ai-gray: #f1f2f6;
        }

        body, html { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; background: #000; color: white; }
        
        .layout { display: flex; height: 100vh; width: 100vw; }

        /* Sidebar Professionnelle */
        .sidebar {
            width: 320px;
            background: var(--primary);
            border-right: 3px solid var(--accent);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .prof-avatar {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 4px solid var(--accent);
            background: url('https://img.freepik.com/vecteurs-premium/professeur-sciences-debout-devant-tableau-noir-tenant-pointeur_113065-225.jpg') center/cover;
            margin-bottom: 20px;
        }

        .philosophy-box {
            margin-top: auto;
            text-align: center;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: var(--accent);
            font-style: italic;
            font-size: 1.1em;
        }

        /* Chat Window */
        .chat-container { flex: 1; background: white; display: flex; flex-direction: column; color: #333; }
        
        #display { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }

        .bubble { max-width: 80%; padding: 15px 20px; border-radius: 15px; line-height: 1.6; }
        .user { align-self: flex-end; background: var(--user-blue); color: white; border-bottom-right-radius: 2px; }
        .ai { align-self: flex-start; background: var(--ai-gray); border-left: 5px solid var(--primary); border-bottom-left-radius: 2px; }

        /* Controls */
        .controls { padding: 25px; background: #f9f9f9; display: flex; gap: 15px; border-top: 2px solid #eee; }
        
        input { flex: 1; padding: 15px; border-radius: 30px; border: 2px solid #ddd; outline: none; font-size: 16px; }
        button { background: var(--primary); color: white; border: none; width: 55px; height: 55px; border-radius: 50%; cursor: pointer; font-size: 1.5em; transition: 0.3s; }
        button:hover { background: var(--accent); transform: scale(1.1); }
        .mic-btn { background: #d63031; }
        .mic-on { animation: pulse 1s infinite; background: #ff7675; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="layout">
    <div class="sidebar">
        <div class="prof-avatar"></div>
        <h2 style="margin: 10px 0;">Prof. Volta</h2>
        <p style="font-size: 0.9em; opacity: 0.7; text-align: center;">Syst√®me d'Expertise en √âlectricit√© Haute-Tension et √âlectronique</p>
        
        <div class="philosophy-box">
            "Les choix d'aujourd'hui impactent le futur."
        </div>
    </div>

    <div class="chat-container">
        <div id="display">
            <div class="bubble ai">
                Bonjour. Je suis le Professeur Volta. Posez-moi vos questions sur les circuits, les machines √©lectriques ou les lois physiques. Je vous r√©pondrai par √©crit et de vive voix.
            </div>
        </div>

        <div class="controls">
            <button id="mic" class="mic-btn">üé§</button>
            <input type="text" id="prompt" placeholder="Posez votre question ici...">
            <button id="send">‚ö°</button>
        </div>
    </div>
</div>

<script>
    // UTILISATION D'UNE CL√â API LIBRE (Open Access)
    const KEY = "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";
    const API_URL = "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.3";

    const display = document.getElementById('display');
    const input = document.getElementById('prompt');
    const sendBtn = document.getElementById('send');
    const micBtn = document.getElementById('mic');

    // Synth√®se Vocale (Parole)
    function speak(text) {
        const synth = window.speechSynthesis;
        const utterance = new SpeechSynthesisUtterance(text.replace(/[$#*]/g, ''));
        utterance.lang = 'fr-FR';
        utterance.rate = 1.0;
        synth.speak(utterance);
    }

    // Reconnaissance Vocale (Micro)
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (Speech) {
        const recognition = new Speech();
        recognition.lang = 'fr-FR';
        micBtn.onclick = () => {
            recognition.start();
            micBtn.classList.add('mic-on');
        };
        recognition.onresult = (e) => {
            input.value = e.results[0][0].transcript;
            micBtn.classList.remove('mic-on');
            askAI();
        };
    }

    async function askAI() {
        const val = input.value.trim();
        if (!val) return;

        addMsg(val, 'user');
        input.value = "R√©flexion du professeur...";
        input.disabled = true;

        try {
            const res = await fetch(API_URL, {
                headers: { Authorization: `Bearer ${KEY}`, "Content-Type": "application/json" },
                method: "POST",
                body: JSON.stringify({ 
                    inputs: `[INST] Tu es le Professeur Volta. R√©ponds de mani√®re experte en √©lectricit√© √† cette question en fran√ßais. Utilise LaTeX pour les formules: ${val} [/INST]`,
                    parameters: { max_new_tokens: 500 }
                }),
            });

            const data = await res.json();
            let text = "";

            if (data.error && data.error.includes("loading")) {
                text = "Je suis en train de pr√©parer mes dossiers (le mod√®le charge). Veuillez patienter 20 secondes et recommencer.";
            } else {
                text = data[0].generated_text.split("[/INST]")[1].trim();
            }

            addMsg(text, 'ai');
            speak(text);

        } catch (err) {
            addMsg("Une erreur de r√©seau est survenue. V√©rifiez votre connexion.", 'ai');
        }

        input.value = "";
        input.disabled = false;
    }

    function addMsg(text, type) {
        const div = document.createElement('div');
        div.className = `bubble ${type}`;
        div.innerHTML = marked.parse(text);
        display.appendChild(div);
        display.scrollTop = display.scrollHeight;
        if (window.MathJax) MathJax.typesetPromise([div]);
    }

    sendBtn.onclick = askAI;
    input.onkeydown = (e) => { if(e.key === 'Enter') askAI(); };
</script>

</body>
</html>
